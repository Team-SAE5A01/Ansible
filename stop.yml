---
- name: Stop production services
  hosts: all
  become: true
  vars:
    env_file: "{{ project_dir }}/.env"

  tasks:

    # ðŸ”¹ Stop services
    - name: Stop docker-compose services
      ansible.builtin.shell: |
        set -a
        source {{ env_file }}
        set +a
        doppler run -- docker-compose stop
      args:
        chdir: "{{ project_dir }}"
      register: stop_result
      ignore_errors: yes

    - name: Show stop service result
      debug:
        var: stop_result
